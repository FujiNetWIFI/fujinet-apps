#include <conio.h>

#include "animation.h"

// square spiral going in
uint8_t b1_x[] = {
  0, 1, 2, 3, 4, 5, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
  6, 5, 4, 3, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  1, 2, 3, 4, 5, 6, 6, 6, 6, 6, 6, 6, 6,
  5, 4, 3, 2, 1, 1, 1, 1, 1, 1, 1,
  2, 3, 4, 5, 5, 5, 5, 5, 5,
  4, 3, 2, 2, 2, 2, 2,
  3, 4, 4, 4, 3, 2, 1, 0, 0, 0, 0, 0
};

uint8_t b1_y[] = {
  0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
  9, 9, 9, 9, 9, 9, 9, 8, 7, 6, 5, 4, 3, 2, 1,
  1, 1, 1, 1, 1, 1, 2, 3, 4, 5, 6, 7, 8,
  8, 8, 8, 8, 8, 7, 6, 5, 4, 3, 2,
  2, 2, 2, 2, 3, 4, 5, 6, 7,
  7, 7, 7, 6, 5, 4, 3,
  3, 3, 4, 5, 5, 5, 5, 5, 4, 3, 2, 1
};

// up/down/up/down... back to start
uint8_t b2_x[] = {
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
  2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
  3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
  6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
  7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
  6, 5, 4, 3, 2, 1
};

uint8_t b2_y[] = {
  0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
  9, 8, 7, 6, 5, 4, 3, 2, 1, 0,
  0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
  9, 8, 7, 6, 5, 4, 3, 2, 1, 0,
  0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
  9, 8, 7, 6, 5, 4, 3, 2, 1, 0,
  0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
  9, 8, 7, 6, 5, 4, 3, 2, 1, 0,
  0, 0, 0, 0, 0, 0
};

// diagonal, up, diaganal, up, ...
uint8_t b3_x[] = {
  0, 1, 2, 3, 3, 3, 4, 5, 6, 7,
  7, 7, 7, 7, 7, 7, 7, 7, 7,
  6, 5, 4, 4, 4, 3, 2, 1, 0,
  0, 0, 0, 0, 0, 0, 0, 0
};

uint8_t b3_y[] = {
  0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
  8, 7, 6, 5, 4, 3, 2, 1, 0,
  1, 2, 3, 4, 5, 6, 7, 8, 9,
  8, 7, 6, 5, 4, 3, 2, 1
};

// a bit like a hilbert curve
uint8_t b4_x[] = {
  0, 0, 0, 1, 1, 2, 3, 3, 2, 2, 3, 3,
  2, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0,
  1, 1, 2, 2, 3, 3, 3, 2, 2, 2, 3, 3,
  4, 4, 5, 5, 5, 4, 4, 4, 5, 5, 6, 6, 
  7, 7, 7, 6, 6, 7, 7, 7, 7, 6, 6, 5,
  4, 4, 5, 5, 4, 4, 5, 6, 6, 7, 7, 7,
  6, 5, 4, 3, 2, 1
};

uint8_t b4_y[] = {
  0, 1, 2, 2, 1, 1, 1, 2, 2, 3, 3, 4,
  4, 4, 3, 3, 4, 5, 6, 6, 7, 7, 8, 9,
  9, 8, 8, 9, 9, 8, 7, 7, 6, 5, 5, 6,
  6, 5, 5, 6, 7, 7, 8, 9, 9, 8, 8, 9,
  9, 8, 7, 7, 6, 6, 5, 4, 3, 3, 4, 4,
  4, 3, 3, 2, 2, 1, 1, 1, 2, 2, 1, 0,
  0, 0, 0, 0, 0, 0
};

size_t b1_x_size = sizeof(b1_x);
size_t b1_y_size = sizeof(b1_y);
size_t b2_x_size = sizeof(b2_x);
size_t b2_y_size = sizeof(b2_y);
size_t b3_x_size = sizeof(b3_x);
size_t b3_y_size = sizeof(b3_y);
size_t b4_x_size = sizeof(b4_x);
size_t b4_y_size = sizeof(b4_y);


void animate(BoxAnimation* b)
{
  int8_t old_pos = 0;
  if ((current_frame % b->modulus) == 0) {
    // remove the end of the trail
    old_pos = b->current - b->trail_len;
    if (old_pos < 0) old_pos += b->data_len;
    cputcxy(b->x_offset + b->x_data[old_pos], b->y_offset + b->y_data[old_pos], ' ');
    
    // print the current
    cputcxy(b->x_offset + b->x_data[b->current], b->y_offset + b->y_data[b->current], b->pixel);

    b->current = b->current + 1;
    if (b->current >= b->data_len) {
      b->current = 0;
      b->pixel++;
    }
  }
}